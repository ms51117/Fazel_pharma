{# admin_panel/templates/sidebar.html - FINAL, CORRECTED LOGIC #}

<nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
    <div class="position-sticky pt-3">
        <ul class="nav flex-column">
            {% for view in admin.views %}
                <li class="nav-item">

                    {% if view.model is defined %}
                        {# --- این یک ModelView است (مانند UsersAdmin) --- #}
                        {# نام روت برای لیست همیشه 'admin:list' است و 'identity' به عنوان پارامتر ارسال می‌شود #}
                        {% set list_url = url_for('admin:list', identity=view.identity) %}
                        {% set base_path = '/admin/' + view.identity %}

                        {# تگ 'a' به طور کامل در این بلوک قرار دارد #}
                        <a class="nav-link {% if request.url.path.startswith(base_path) %}active{% endif %}" href="{{ list_url }}">
                            <i class="{{ view.icon }}"></i>
                            {{ view.name_plural if view.name_plural else view.name }}
                        </a>
                    {% else %}
                        {# --- این یک BaseView است (مانند DashboardView) --- #}
                        {# نام روت آن 'admin:' + نام تابع است #}
                        {% set view_route_name = 'admin:' + view.identity %}
                        {% set view_url = url_for(view_route_name) %}

                        {# تگ 'a' به طور کامل در این بلوک قرار دارد و از منطق خودش استفاده می‌کند #}
                        <a class="nav-link {% if request.url.path == view_url %}active{% endif %}" href="{{ view_url }}">
                            <i class="{{ view.icon }}"></i>
                            {{ view.name }}
                        </a>
                    {% endif %}

                </li>
            {% endfor %}
        </ul>
    </div>
</nav>
